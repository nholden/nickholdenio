<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Replacing .each_with_index with .map to streamline Ruby code | Nick Holden dot IO</title>
    <link href="../../../../stylesheets/all.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <script src="../../../../javascripts/all.js" type="text/javascript"></script>

    <!-- Google Analytics //-->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-64216632-1', 'auto');
      ga('send', 'pageview');
    </script>

  </head>

  <body class="blog blog_2015 blog_2015_07 blog_2015_07_19 blog_2015_07_19_replacing-each_with_index-with-map-to-streamline-ruby-code">
    <div class="hero"></div>
    <div class="headshot">
<a href="/">        <img src="/images/headshot.png" alt="Nick Holden" />
</a>    </div>
    <div class="blog-article">
  <article>
    <div class="title">Replacing .each_with_index with .map to streamline Ruby code</div>
    <div class="date">July 19, 2015</div>
    <div class="body">
      <p>I recently had to write a method that would take an encrypted message and return a decrypted message using a key. The key was a hash of numeric codes and words like this.</p>

<pre class="highlight ruby"><code>  <span class="p">{</span> <span class="s2">"1"</span> <span class="o">=&gt;</span> <span class="s2">"secret"</span><span class="p">,</span> <span class="s2">"2"</span> <span class="o">=&gt;</span> <span class="s2">"message"</span><span class="p">}</span>
</code></pre>

<p>I wanted to write a method that would look at each numeric code in the encrypted message and find its decrypted word in the key. I was familiar with using <code>.each</code> on arrays to perform actions on a bunch of elements, so I decided to convert the encrypted message into an array of numeric codes, replace each of the codes with words, and convert the array back into a string.</p>

<pre class="highlight ruby"><code>  <span class="k">class</span> <span class="nc">Cipher</span>
    <span class="vc">@@key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"1"</span> <span class="o">=&gt;</span> <span class="s2">"secret"</span><span class="p">,</span> <span class="s2">"2"</span> <span class="o">=&gt;</span> <span class="s2">"message"</span><span class="p">}</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">decrypt_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
      <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
      <span class="n">message</span><span class="p">.</span><span class="nf">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">word</span><span class="p">,</span> <span class="n">index</span><span class="o">|</span>
        <span class="n">message</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="vc">@@key</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
      <span class="k">end</span>
      <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>

<p>The method accomplished what I wanted it to do. When I called <code>Cipher.decrypt_message("1 2")</code>, it returned "secret message."</p>

<p>This was great, but it seemed like too many lines of code for such a simple task. I remembered seeing a <code>.map</code> method before, but I wasn't sure exactly what it did. I took a look at the Ruby documentation for array, and I figured out how to replace <code>.each_with_index</code> in my method with <code>.map</code>.</p>

<pre class="highlight ruby"><code>  <span class="k">class</span> <span class="nc">Cipher</span>
    <span class="vc">@@key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"1"</span> <span class="o">=&gt;</span> <span class="s2">"secret"</span><span class="p">,</span> <span class="s2">"2"</span> <span class="o">=&gt;</span> <span class="s2">"message"</span><span class="p">}</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">decrypt_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
      <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
      <span class="n">message</span><span class="p">.</span><span class="nf">map!</span><span class="p">{</span> <span class="o">|</span><span class="n">word</span><span class="o">|</span> <span class="vc">@@key</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="p">}</span>
      <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>

<p>With <code>.map</code>, I learned I could replace an element in an array in place without having to remember that element's index. I used <code>.map!</code> so that the array of words would replace the array of numeric codes, rather than returning a copy.</p>

<p>Then I did a little more refactoring.</p>

<pre class="highlight ruby"><code>  <span class="k">class</span> <span class="nc">Cipher</span>
    <span class="vc">@@key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"1"</span> <span class="o">=&gt;</span> <span class="s2">"secret"</span><span class="p">,</span> <span class="s2">"2"</span> <span class="o">=&gt;</span> <span class="s2">"message"</span><span class="p">}</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">decrypt_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
      <span class="n">message</span><span class="p">.</span><span class="nf">split</span><span class="p">.</span><span class="nf">map!</span><span class="p">{</span> <span class="o">|</span><span class="n">word</span><span class="o">|</span> <span class="vc">@@key</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="p">}.</span><span class="nf">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>

<p>By chaining the methods I wanted to call on the encrypted message together and removing the optional parameter from <code>.split</code>, I reduced my method down to one short line.</p>

    </div>
  </article>
</div>

    <div class="footer">
      <h2>Get in touch</h2>
      <a href="mailto:nick.r.holden@gmail.com"><i class="fa fa-envelope-o"></i> nick.r.holden@gmail.com</a><br />
      <a href="https://github.com/nholden" target="_blank"><i class="fa fa-github"></i> nholden</a><br />
      <a href="https://www.linkedin.com/in/nickholden" target="_blank"><i class="fa fa-linkedin-square"></i> Nick Holden</a><br />
      <a href="https://www.twitter.com/nickyholden" target="_blank"><i class="fa fa-twitter-square"></i> @NickyHolden</a>
    </div>
  </body>
</html>
